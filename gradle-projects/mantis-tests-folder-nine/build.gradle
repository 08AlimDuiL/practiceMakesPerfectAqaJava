plugins {
    id 'java'
    id 'com.adarshr.test-logger' version '3.2.0'
}

group = 'neo'
version = '1.0-SNAPSHOT'

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(11)
    }
}

repositories {
    mavenCentral()
}

dependencies {
    testImplementation 'org.testng:testng:6.14.3'
    implementation 'org.seleniumhq.selenium:selenium-java:4.15.0'
    testImplementation 'org.hamcrest:hamcrest:2.2'
    implementation 'org.apache.httpcomponents.client5:httpclient5:5.2.1'
    implementation 'commons-net:commons-net:3.9.0'
    implementation 'hu.blackbelt.bundles.subethasmtp:org.subethamail.subethasmtp:3.1.7_1'
    implementation 'ru.lanwen.verbalregex:java-verbal-expressions:1.8'
    implementation 'ch.qos.logback:logback-classic:1.5.20'

    // CXF Ğ´Ğ»Ñ SOAP
    implementation 'org.apache.cxf:cxf-rt-frontend-jaxws:4.0.3'
    implementation 'org.apache.cxf:cxf-rt-transports-http:4.0.3'
    implementation 'org.apache.cxf:cxf-rt-features-logging:4.0.3'

    // JAXB Ğ´Ğ»Ñ Java 11+ (Ğ’ĞĞ–ĞĞ!)
    implementation 'jakarta.xml.bind:jakarta.xml.bind-api:4.0.0'
    implementation 'com.sun.xml.bind:jaxb-impl:4.0.2'
    implementation 'jakarta.activation:jakarta.activation-api:2.1.0'

    // Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ XML Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸
    implementation 'org.glassfish.jaxb:jaxb-runtime:4.0.2'
    implementation 'jakarta.xml.ws:jakarta.xml.ws-api:4.0.0'
    implementation 'com.sun.xml.messaging.saaj:saaj-impl:3.0.2'

    implementation 'biz.futureware.mantis:mantis-axis-soap-client:1.2.19'
}


// Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½ÑƒÑ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² WSDL2Java
configurations {
    cxfTool
}

dependencies {
    cxfTool 'org.apache.cxf:cxf-tools-wsdlto-frontend-jaxws:4.0.3'
    cxfTool 'org.apache.cxf:cxf-tools-wsdlto-databinding-jaxb:4.0.3'
    cxfTool 'org.apache.cxf:cxf-tools-common:4.0.3'
    cxfTool 'org.apache.cxf:cxf-tools-wsdlto-core:4.0.3'
    cxfTool 'jakarta.xml.bind:jakarta.xml.bind-api:4.0.0'
    cxfTool 'com.sun.xml.bind:jaxb-impl:4.0.2'
}

// Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ´Ğ»Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Java ĞºĞ»Ğ°ÑÑĞ¾Ğ² Ğ¸Ğ· WSDL
task generateFromWsdl(type: JavaExec) {
    classpath = configurations.cxfTool
    main = 'org.apache.cxf.tools.wsdlto.WSDLToJava'

    args = [
            '-d', 'src/main/java',          // Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ½Ğ°Ñ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ
            '-p', 'ru.stqa.pft.soap',                 // package name
            '-client',                      // Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ»Ğ¸ĞµĞ½Ñ‚
            '-verbose',                     // Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ²Ğ¾Ğ´
            'src/main/resources/calculator.wsdl'  // WSDL Ñ„Ğ°Ğ¹Ğ»
    ]

    // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ¼ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
    doFirst {
        println "â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„"
        println "ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Java ĞºĞ»Ğ°ÑÑĞ¾Ğ² Ğ¸Ğ· WSDL..."
        println "ğŸ“ WSDL Ñ„Ğ°Ğ¹Ğ»: src/main/resources/calculator.wsdl"
        println "ğŸ“ Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ğ°Ñ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ: src/main/java"
        println "ğŸ“¦ Package: mantis"
        println "â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„"
    }

    doLast {
        println "âœ… Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°! ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ¿Ğ°Ğ¿ĞºÑƒ src/main/java/mantis/"
    }
}

// Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ñ†Ğ¸ĞºĞ»Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ - ĞºĞ¾Ğ¼Ğ¿Ğ¸Ğ»ÑÑ†Ğ¸Ñ ĞĞ• Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
// Ğ’Ğ¼ĞµÑÑ‚Ğ¾ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ ĞºĞ¾Ğ³Ğ´Ğ° Ğ½ÑƒĞ¶Ğ½Ğ¾


test {
    useTestNG() {
        suites('src/test/resources/testng.xml')
    }

    if (project.hasProperty('browser')) {
        systemProperty 'browser', "${browser}"
    }
    if (project.hasProperty('target')) {
        systemProperty 'target', "${target}"
    }
    if (project.hasProperty('verifyUi')) {
        systemProperty 'verifyUi', "${verifyUi}"
    }

    afterTest { desc, result ->
        println "â”Œâ”€ Ğ¢ĞµÑÑ‚: ${desc.className}.${desc.name}"
        println "â”œâ”€ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: ${result.resultType}"
        println "â””â”€ Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ: ${result.endTime - result.startTime}ms"
    }

    afterSuite { suite, result ->
        if (!suite.parent) {
            println "\n" + "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            println "â•‘             Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢Ğ« Ğ¢Ğ•Ğ¡Ğ¢ĞĞ’                        â•‘"
            println "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
            println "â•‘ Ğ’ÑĞµĞ³Ğ¾ Ñ‚ĞµÑÑ‚Ğ¾Ğ²: ${result.testCount}".padRight(55) + "â•‘"
            println "â•‘ Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾: ${result.successfulTestCount}".padRight(55) + "â•‘"
            println "â•‘ ĞŸÑ€Ğ¾Ğ²Ğ°Ğ»ĞµĞ½Ğ¾: ${result.failedTestCount}".padRight(55) + "â•‘"
            println "â•‘ ĞŸÑ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾: ${result.skippedTestCount}".padRight(55) + "â•‘"
            println "â•‘ Ğ’Ñ€ĞµĞ¼Ñ: ${result.endTime - result.startTime}ms".padRight(55) + "â•‘"
            println "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        }
    }
}